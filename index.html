<!doctype html>
<html lang="ru">

    <head>
        <meta charset="utf-8">

        <title>Ленивые вычисления</title>

        <meta name="description" content="Доклад о ленивых вычислениях на РИФ-Воронеж, 11 сентября 2015 года.">
        <meta name="author" content="Денис Шевченко">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/solarized.css" id="theme">
        <link rel="stylesheet" href="css/own.css">
        <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">

        <!-- Code syntax highlighting -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="reveal">
            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides" style="text-align: left !important;">
                <section>
                    <h1>Зачем нужен<br/>
                        Haskell:</h1>
                    <span style="font-size: 75px; color: #777;">ленивые вычисления</span>
                </section>

                <!-- Концептуальная цитата -->

                <section>
                    <div class="intro-quote">
                        <span style="color: #ccc;"><i class="fa fa-quote-right"></i></span>&nbsp;&nbsp;Лучше<br/>
                        <span style="padding-left: 111px;">ничем не заниматься,</span><br/>
                        <span style="padding-left: 113px;"></span> чем заниматься ничем.
                    </div>
                    <div class="medium-text" style="color: #777 !important; text-align: left; padding-left: 156px; font-size: 44px !important;">Тацит</div>
                </section>

                <section data-background="#336B87">
                    <h2 class="part-conception-title">Начало</h2>
                </section>

                <section>
                    <div class="lambda-code">
                        &nbsp;&lambda;x.x + 1
                    </div>
                </section>

                <section>
                    <div class="lambda-code">
                        (&lambda;x.x + 1) 6 <span class="fragment">= 7</span>
                    </div>
                </section>

                <section>
                    <div class="lambda-code">
                        (&lambda;x.x + 1) 2 * 3
                    </div>
                </section>

                <!-- Что делать с выражением? -->

                <section>
                    <div class="lambda-code">
                        <span style="color: #ccc;">(&lambda;x.x + 1)</span> <strong>2 * 3</strong>
                    </div>
                </section>

                <!-- Жадный подход -->

                <section>
                    <div class="lambda-code">
                        <span style="color: #ccc;">(&lambda;x.x + 1)</span> <strong>6</strong><br/>
                    </div>
                </section>

                <section>
                    <div class="lambda-code">
                        <div style="padding-top: 117px;"></div>
                        <span style="color: #ccc;">(&lambda;x.x + 1)</span><br/>
                        &nbsp;&rArr;&nbsp;&nbsp;<strong>6</strong> + 1
                    </div>
                </section>

                <section>
                    <div style="text-align: center;">
                        <span class="big-text"><span class="red-text">Жадное</span> вычисление</span>
                    </div>
                    <div class="lambda-code">
                        <div style="padding-top: 40px;"></div>
                        <span style="color: #ccc;">(&lambda;x.x + 1)</span><br/>
                        &nbsp;&rArr;&nbsp;&nbsp;<strong>6</strong> + 1
                    </div>
                </section>

                <!-- Ленивый подход -->

                <section>
                    <div class="lambda-code">
                        <span style="color: #ccc;">(&lambda;x.x + 1)</span> <strong>2 * 3</strong><br/>
                    </div>
                </section>

                <section>
                    <div class="lambda-code">
                        <div style="padding-top: 117px;"></div>
                        <span style="color: #ccc;">(&lambda;x.x + 1)</span><br/>
                        &nbsp;&rArr;&nbsp;&nbsp;(<strong>2 * 3</strong>) + 1
                    </div>
                </section>

                <section>
                    <div style="text-align: center;">
                        <span class="big-text"><span class="red-text">Ленивое</span> вычисление</span>
                    </div>
                    <div class="lambda-code">
                        <div style="padding-top: 40px;"></div>
                        <span style="color: #ccc;">(&lambda;x.x + 1)</span><br/>
                        &nbsp;&rArr;&nbsp;&nbsp;(<strong>2 * 3</strong>) + 1
                    </div>
                </section>

                <!-- Принципы -->

                <section data-background="#336B87">
                    <h2 class="part-conception-title">Принципы</h2>
                </section>

                <!-- Как можно позже -->

                <section data-background="#336B87">
                    <h3 class="part-conception-title"><span class="num-light">1</span> Как можно позже</h3>
                </section>

                <section>
                    <pre><code class="haskell" data-trim>
main :: IO ()
main =
  let result = 2 `div` 0
  in print result
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Ошибка</div>
                </section>

                <section>
                    <pre><code class="haskell" data-trim>
main :: IO ()
main =
  let result = 2 `div` 0
  in putStrLn "Bye!"
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Нет ошибки</div>
                </section>

                <!-- Как можно меньше -->

                <section data-background="#336B87">
                    <h3 class="part-conception-title"><span class="num-light">2</span> Как можно меньше</h3>
                </section>

                <section>
                    <pre><code class="haskell" data-trim>
main :: IO ()
main =
  let cx     = 2 / 6.054
      nk     = 4 * 12.003
      coeffs = [cx, nk]
  in putStrLn "Nothing..."
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left" style="float: left;">Ничего</div>
                    <div class="fragment">
                        <div class="big-text text-right red-text" style="padding-right: 45px;">
                            Thunk
                        </div>
                    </div>
                </section>

                <section>
                    <pre><code class="haskell" data-trim>
main :: IO ()
main =
  let cx     = 2 / 6.054
      nk     = 4 * 12.003
      coeffs = [cx, nk]
  in print $ length coeffs
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left" style="float: left;">Только длина</div>
                    <div class="fragment">
                        <div class="big-text text-right red-text" style="padding-right: 45px;">
                            WHNF
                        </div>
                    </div>
                </section>

                <section>
                    <pre><code class="haskell" data-trim>
main :: IO ()
main =
  let cx     = 2 / 6.054
      nk     = 4 * 12.003
      coeffs = [cx, nk]
  in print $ coeffs !! 1
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left" style="float: left;">Только второй</div>
                    <div class="fragment">
                        <div class="big-text text-right red-text" style="padding-right: 45px;">
                            WHNF
                        </div>
                    </div>
                </section>

                <section>
                    <pre><code class="haskell" data-trim>
main :: IO ()
main =
  let cx     = 2 / 6.054
      nk     = 4 * 12.003
      coeffs = [cx, nk]
  in print coeffs
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left" style="float: left;">Всё</div>
                    <div class="fragment">
                        <div class="big-text text-right red-text" style="padding-right: 45px;">
                            Normal form
                        </div>
                    </div>
                </section>

                <section data-background="#336B87">
                    <h2 class="part-conception-title">Ну и что?</h2>
                </section>

                <!-- Плюсы -->

                <section data-background="#336B87">
                    <h3 class="part-conception-title"><span class="num-light">1</span> Рациональность</h3>
                </section>

                <section>
                    <pre><code class="haskell src-code src-code-small" data-trim>
main :: IO ()
main =
  let evens = [2, 4 .. 100]
  in print $ take 10 evens
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Столько, сколько нужно</div>
                </section>

                <section data-background="#336B87">
                    <h3 class="part-conception-title"><span class="num-light">2</span> Бесконечность</h3>
                </section>

                <section>
                    <pre><code class="haskell src-code src-code-small" data-trim>
main :: IO ()
main =
  let evens = [2, 4 ..]
  in print $ take 10 evens
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">И опять только десять</div>
                </section>

                <section data-background="#336B87">
                    <h3 class="part-conception-title"><span class="num-light">3</span> EDSL</h3>
                </section>

                <section>
                    <pre><code class="haskell src-code src-code-small" data-trim>
(?) :: Bool -> (a, a) -> a
True  ? (f, _) = f
False ? (_, s) = s
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Замена <strong><span class="code-inline">if</span></strong></div>
                </section>

                <section>
                    <pre><code class="haskell src-code-small" data-trim>
main :: IO ()
main = do
  putStrLn "Input prefix:"
  prefix <- getLine
  (prefix == "https") ?
    (putStrLn "Secure web!",
     exitFailure)
                    </code></pre>
                </section>

                <!-- Но... -->

                <section data-background="#111" data-background-transition="convex">
                    <h2 class="part-conception-title">Но&#8230;</h2>
                </section>

                <!-- Минус -->

                <section data-background="#336B87">
                    <h2 class="part-conception-title">Space leak</h2>
                </section>

                <section>
                    <h3>Не путать с Memory Leak!</h3>
                </section>

                <section>
                    <h3>Memory Leak &mdash;</h3>
                    <div class="big-text">низкоуровневая ошибка<br/>управления памятью</div>
                    <div class="memory-error-sign">
                        <i class="fa fa-cogs"></i>
                    </div>
                </section>

                <section>
                    <h3>Space Leak &mdash;</h3>
                    <div class="big-text">высокоуровневая ошибка<br/>проектирования</div>
                    <div class="memory-error-sign">
                        <i class="fa fa-binoculars"></i>
                    </div>
                </section>

                <section>
                    <pre><code class="haskell src-code-small" data-trim>
main :: IO ()
main =
    let stupid = 2 `div` 0
    in putStrLn "Just exit!"
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Деления не было</div>
                </section>

                <section>
                    <pre><code class="haskell src-code" data-trim>
2 `div` 0
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left"><span class="minus-color">Невычисленное</span> (отложенное) выражение</div>
                    <div class="english-separator"></div>
                    <div class="fragment big-text text-left">/<span class="small-text">англ.</span> <span class="minus-color">unevaluated</span> expression <span class="small-text">или</span> thunk</span>/</div>
                </section>

                <section>
                    <h3>Все отложенные выражения</h3>
                    <div class="big-text">живут в памяти</div>
                    <div class="english-separator"></div>
                    <div class="fragment big-text thank-you-cap">Thank you Cap!</div>
                </section>

                <section>
                    <h3>Проблема в их количестве!</h3>
                    <div class="quantity-sign">
                        <i class="fa fa-line-chart"></i>
                    </div>
                </section>

                <section>
                    <pre><code class="haskell src-code-small" data-trim>
f :: Num b => [a] -> b -> b
f []     c = c
f (_:xs) c = f xs $ c + 1
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Пустышка с большой проблемой</div>
                </section>

                <section>
                    <pre><code class="bash src-code" data-trim>
f  [1,2,3]   0
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Применяем&hellip;</div>
                </section>

                <section>
                    <pre><code class="bash src-code" data-trim>
f  1:[2,3]   0 + 1
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Первый шаг&hellip;</div>
                </section>

                <section>
                    <pre><code class="bash src-code" data-trim>
f  1:2:[3]   (0 + 1) + 1
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Второй шаг&hellip;</div>
                </section>

                <section>
                    <pre><code class="bash src-code" data-trim>
f  1:2:3:[]  ((0 + 1) + 1) + 1
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Третий шаг&hellip;</div>
                </section>

                <section>
                    <pre><code class="bash src-code" data-trim>
f  []        ((0 + 1) + 1) + 1
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Последний шаг&hellip;</div>
                </section>

                <section>
                    <pre><code class="bash src-code" data-trim>
((0 + 1) + 1) + 1 = 3
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Готово</div>
                </section>

                <section>
                    <h3 class="text-left">Ленивый вариант</h3>
                    <div class="above-src-code-separator"></div>
                    <pre><code class="haskell src-code-small" data-trim>
main :: IO ()
main =
    let v = f [1..50000000] (0 :: Integer)
    in print v
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="stat-wrapper">
                        <span class="fragment big-text"><span class="stat-clock-icon"><i class="fa fa-clock-o"></i></span> Время: <span class="minus-color">62 с</span></span>
                    <div class="english-separator"></div>
                    <span class="fragment big-text"><span class="stat-memory-icon"><i class="fa fa-area-chart"></i></span> Память: <span class="minus-color">6.19 ГБ</span></span>
                </section>

                <section>
                    <pre><code class="haskell src-code-small" data-trim>
f' :: Num b => [a] -> b -> b
f' []     c = c
f' (_:xs) c = f' xs $! c + 1
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="big-text text-left">Пустышка без проблем</div>
                </section>

                <section>
                    <h3 class="text-left">Строгий вариант</h3>
                    <div class="above-src-code-separator"></div>
                    <pre><code class="haskell src-code-small" data-trim>
main :: IO ()
main =
    let v = f' [1..50000000] (0 :: Integer)
    in print v
                    </code></pre>
                    <div class="under-src-code-separator"></div>
                    <div class="stat-wrapper">
                        <span class="fragment big-text"><span class="stat-clock-icon"><i class="fa fa-clock-o"></i></span> Время: <span class="minus-color">4 с</span></span>
                    <div class="english-separator"></div>
                    <span class="fragment big-text"><span class="stat-memory-icon"><i class="fa fa-area-chart"></i></span> Память: <span class="minus-color">мизерная</span></span>
                </section>

                <section>
                    <h3><span class="minus-color">Выход:</span></h3>
                    <div class="big-text">Если код может раздуться,<br/>разбавьте лень строгостью</div>
                </section>

                <!-- Итоги -->

                <section>
                    <pre><code class="haskell src-code-small" data-trim>
main :: IO ()
main =
    print $ Laziness good bad
    where good = [ "Рациональность"
                 , "Бесконечность"
                 , "DSL"
                 ]
          bad  = [ "Неожиданное поведение"
                 , "Space Leak"
                 ]
                    </code></pre>
                </section>

                <!-- Благодарю за внимание! -->

                <section>
                    <h3>Благодарю за внимание!</h3>
                    <div style="padding-top: 50px;"></div>
                    <div class="medium-text">Денис Шевченко</div>
                    <div class="english-separator"></div>
                    <a href="http://dshevchenko.biz" target="_blank"><i class="fa fa-external-link"></i> <span class="my-site">dshevchenko.biz</span></a>
                </section>

            </div>

        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>

        <script>

            // Full list of configuration options available at:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,

                transition: 'fade', // none/fade/slide/convex/concave/zoom

                // Optional reveal.js plugins
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    // { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    // { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true },
                    { src: 'plugin/notes/notes.js', async: true }
                ]
            });

        </script>

    </body>
</html>
